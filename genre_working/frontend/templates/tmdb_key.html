<!DOCTYPE html>
<html>
<head>
  <title>TMDB Key</title>
</head>
<body>

  <h3>Enter TMDB API Key</h3>

  <form id="tmdbForm">
    <input id="tmdbKey" type="text" placeholder="TMDB API Key" required />
    <button type="submit" id="saveBtn">Save</button>
  </form>

  <p id="status"></p>

  <script>
    const form = document.getElementById("tmdbForm");
    const status = document.getElementById("status");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const apiKey = document.getElementById("tmdbKey").value.trim();
      if (!apiKey) return;

      try {
        const res = await fetch("http://localhost:8000/tmdb/key", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          credentials: "include",
          body: JSON.stringify({ apiKey })
        });

        const data = await res.json();
        if (!res.ok) {
          status.textContent = data.error;
          return;
        }

        status.textContent = "TMDB key saved successfully";

        // Redirect back to previous page
        const redirectUrl = localStorage.getItem("redirectAfterTMDB") || "genre.html";
        localStorage.removeItem("redirectAfterTMDB");
        window.location.href = redirectUrl;

      } catch (err) {
        status.textContent = "Server not reachable";
      }
    });
  </script>

</body>
</html>
